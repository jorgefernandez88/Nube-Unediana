<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pomodoro Timer</title>
    <link rel="stylesheet" href="styles.css">
    <script src="script.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <base target="_blank">
    <!-- Sistema completo de fuentes -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">

    <!-- Mejoras de accesibilidad -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#3b82f6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">

    <!-- Precarga de fuentes cr√≠ticas -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;900&display=swap"
        as="style" onload="this.onload=null;this.rel='stylesheet'">
    <style>
        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.6;
            }
        }
    </style>
</head>

<body>
    <header>
        <h1 style="display: flex; flex-direction: column; align-items: center; gap: 5px;">
            <div><i class="fas fa-clock"></i> Pomodoro Timer</div>
            <nav class="page-nav"
                style="background: transparent; box-shadow: none; border: none; padding: 0; width: auto; min-height: 0; margin: 0;">
                <ul style="padding: 0; margin: 0;">
                    <li>
                        <a href="index.html" style="padding: 5px 20px; font-size: 0.9rem;">
                            <i class="fas fa-arrow-left nav-icon" style="font-size: 1rem;"></i>
                            <span class="nav-text" style="font-size: 0.9rem;">Volver al inicio</span>
                            <i class="fas fa-home nav-icon" style="margin-left: 10px; font-size: 1rem;"></i>
                        </a>
                    </li>
                </ul>
            </nav>
        </h1>
        <nav>

            <div class="theme-switch-wrapper">
                <label class="theme-switch" for="checkbox">
                    <input type="checkbox" id="checkbox" onchange="toggleTheme()" />
                    <div class="slider">
                        <span class="theme-icon sun">‚òÄÔ∏è</span>
                        <span class="theme-icon moon">üåô</span>
                    </div>
                </label>
            </div>
        </nav>
    </header>

    <main>

        <div class="welcome-section">
            <h3>Este pomodoro tiene 3 modos a escoger y un reproductor de m√∫sica de diferentes estilos para ayudar a la
                concentraci√≥n</h3>
        </div>


        <!-- Bot√≥n expandible para instrucciones -->
        <button class="instrucciones-toggle-btn" onclick="toggleInstrucciones()">
            <span>Ver instrucciones</span>
            <i class="fas fa-chevron-down"></i>
        </button>

        <!-- Contenido colapsable de instrucciones -->
        <div class="instrucciones-content">
            <table class="explicaciones-tabla">
                <thead>
                    <tr>
                        <th colspan="2">Instrucciones:</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="icono-celda">
                            <i class="fas fa-calculator"></i>
                        </td>
                        <td class="contenido-celda">
                            <ol class="pasos-lista">
                                <li class="paso-item">El modo "Normal" establece solo 25 minutos.</li>
                                <li class="paso-item">En el modo "Focus" se seleccionan la cantidad de rondas de 25
                                    minutos, el pomodoro avanzar√° por cada un de forma autom√°tica incluyendo 5 minutos
                                    de descanso por cada ronda.</li>
                                <li class="paso-item">El modo "Flow" permite definir la cantidad de tiempo que se desea,
                                    por defecto establece 25 minutos, pero se puede modificar al gusto.</li>
                                <li class="paso-item">No te olvides del reproductor de m√∫sica y selecciona la playlist
                                    que prefieras.</li>
                                <li class="paso-item">Presione el bot√≥n "Iniciar" para comenzar el pomodoro.</li>
                                <li class="paso-item">Presione el bot√≥n "Pausar" para pausar el pomodoro.</li>
                                <li class="paso-item">Presione el bot√≥n "Reiniciar" para reiniciar el pomodoro.</li>
                                <li class="paso-item">Presione el bot√≥n "Continuar" para continuar d√≥nde qued√≥
                                    anteriormente.</li>
                                <li class="paso-item">Puede agregar la cantidad de tareas que desee, solo presione
                                    "Agregar tarea"; las tareas se clasifican segun su estado: "Pendiente", "En proceso"
                                    y "Terminado".</li>
                                <li class="paso-item">Al seleccionar una canci√≥n el reproductor le mostrar√° un mensaje
                                    de escucharla en la aplicaci√≥n de Ivoox, solamente presiona la X y podr√° escucharla
                                    sin problemas.</li>
                            </ol>
                            <span class="nota-importante">
                                <i class="fas fa-info-circle"></i>
                                El pomodoro avisar√° cuando se acabe el tiempo entre rondas, incluyendo el tiempo de
                                descanso con sonidos.
                            </span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>



        <div class="container-pomodoro">

            <!-- Selector de Modo -->
            <div class="modo-selector">
                <h3>Modo de Pomodoro</h3>
                <div class="modo-buttons">
                    <button class="modo-btn active" onclick="cambiarModo('normal', event)">
                        <i class="fas fa-play"></i> Normal
                    </button>
                    <button class="modo-btn" onclick="cambiarModo('focus', event)">
                        <i class="fas fa-target"></i> Focus
                    </button>
                    <button class="modo-btn" onclick="cambiarModo('flow', event)">
                        <i class="fas fa-water"></i> Flow
                    </button>
                </div>
            </div>

            <!-- Configuraci√≥n del Modo -->
            <div id="configModo" class="config-modo"></div>

            <!-- Timer Digital -->
            <div class="pomodoro-timer">
                <h2>Temporizador Pomodoro</h2>
                <div class="timer-display" id="timerDisplay">25:00</div>
                <div class="timer-controls">
                    <button class="timer-btn" id="startBtn" onclick="iniciarTimer()">
                        <i class="fas fa-play"></i> Iniciar
                    </button>
                    <button class="timer-btn" id="pauseBtn" onclick="pausarTimer()" disabled>
                        <i class="fas fa-pause"></i> Pausar
                    </button>
                    <button class="timer-btn" id="resetBtn" onclick="resetearTimer()">
                        <i class="fas fa-redo"></i> Reiniciar
                    </button>
                </div>
                <div id="timerMessage" class="timer-message oculto">
                    <p>¬°Tiempo! üéâ</p>
                    <p id="timerMessageText">Toma un descanso de 5 minutos</p>
                    <button class="timer-btn" onclick="reiniciarPomodoro()">
                        <i class="fas fa-sync-alt"></i> <span id="btnMessageText">Nuevo Pomodoro</span>
                    </button>
                </div>
                <div id="rondaInfo" class="ronda-info oculto">
                    <p>Ronda <span id="rondaActual">1</span> de <span id="rondaTotal">1</span></p>
                    <p>Tiempo total: <span id="tiempoTotal">0h 30m</span></p>
                </div>
            </div>

            <!-- Lista de Tareas -->
            <div class="tareas-container">
                <div class="tareas-header">
                    <h2><i class="fas fa-tasks"></i> Mis Tareas</h2>
                    <button class="agregar-tarea-btn" onclick="agregarTarea()">
                        <i class="fas fa-plus"></i> Agregar Tarea
                    </button>
                </div>

                <div id="tareasLista" class="tareas-lista"></div>

                <div id="mensajeCompletado" class="mensaje-completado oculto">
                    <i class="fas fa-check-circle"></i>
                    <p>¬°Muy bien, terminaste todas tus tareas!</p>
                </div>
            </div>

            <!-- Reproductor de iVoox DESPLEGABLE -->
            <div class="spotify-container">
                <button class="spotify-toggle-btn" onclick="toggleSpotify()">
                    <i class="fas fa-music"></i>
                    <span id="spotifyToggleText">M√∫sica para concentrarte</span>
                    <i class="fas fa-chevron-down spotify-toggle-icon"></i>
                </button>

                <div id="spotifyContent" class="spotify-content">
                    <h2><i class="fas fa-volume-up"></i>Elije que quieras!</h2>
                    <div class="playlist-selector">
                        <button class="playlist-btn active" onclick="cambiarPlaylist('podcast')">
                            <i class="fas fa-podcast"></i> Podcast
                        </button>
                        <button class="playlist-btn" onclick="cambiarPlaylist('naturaleza')">
                            <i class="fas fa-leaf"></i> Naturaleza
                        </button>
                        <button class="playlist-btn" onclick="cambiarPlaylist('lofi')">
                            <i class="fas fa-headphones"></i> Lo-Fi
                        </button>
                        <button class="playlist-btn" onclick="cambiarPlaylist('clasica')">
                            <i class="fas fa-music"></i> Cl√°sica
                        </button>
                        <button class="playlist-btn" onclick="cambiarPlaylist('relajante')">
                            <i class="fas fa-spa"></i> Relajante
                        </button>

                    </div>
                    <div id="spotifyPlayer" class="spotify-player">
                        <iframe id="spotifyIframe" style="border-radius:12px"
                            src="https://www.ivoox.com/player_es_podcast_1561033_zp_1.html?c1=092151" width="100%"
                            height="400" frameBorder="0" allowfullscreen="" scrolling="no" loading="lazy">
                        </iframe>
                    </div>
                </div>
            </div>

        </div>
    </main>
    <!-- Page Navigation -->
    <nav class="page-nav">
        <ul>
            <li>
                <a href="calculadoranotas.html">
                    <i class="fas fa-check nav-icon"></i>
                    <span class="nav-text">Calcular Notas</span>
                </a>
            </li>
            <li>
                <a href="calculadoramargen.html">
                    <i class="fas fa-chart-pie nav-icon"></i>
                    <span class="nav-text">Calcular Margen</span>
                </a>
            </li>
            <li>
                <a href="calculadoraredondeo.html">
                    <i class="fas fa-percentage nav-icon"></i>
                    <span class="nav-text">Redondear</span>
                </a>
            </li>
            <li>
                <a href="calculadoraaranceles.html">
                    <i class="fas fa-coins nav-icon"></i>
                    <span class="nav-text">Calcular Aranceles</span>
                </a>
            </li>
            <li>
                <a href="pomodorotimer.html">
                    <i class="fas fa-stopwatch nav-icon"></i>
                    <span class="nav-text">Pomodoro</span>
                </a>
            </li>
        </ul>
    </nav>

    <footer>
        <nav>
            <a href="https://www.facebook.com/educacionadistanciacr"><i class="fab fa-facebook"></i></a>
        </nav>
        <h5>&copy; 2025 - 2026 Proyecto de Educaci√≥n a Distancia CR <br> Elaborado por Jorge Fern√°ndez - v2.0</h5>

    </footer>

    <!-- Audio para notificaciones -->
    <audio id="notificationSound" preload="auto">
        <source src="sounds/alarm.mp3" type="audio/mpeg">
    </audio>

    <!-- Audio para switch de tema -->
    <audio id="themeSwitchSound" preload="auto">
        <source src="sounds/prendido.mp3" type="audio/mpeg">
    </audio>

    <!-- Audio para descanso -->
    <audio id="descansoSound" preload="auto">
        <source src="sounds/descanso.mp3" type="audio/mpeg">
    </audio>

    <!-- Audio para cambio de modo -->
    <audio id="modoPomodoroSound" preload="auto">
        <source src="sounds/modpomodoro.mp3" type="audio/mpeg">
    </audio>

    <audio id="popSound" preload="auto">
        <source src="sounds/pop.mp3" type="audio/mpeg">
    </audio>

    <script>
        // ===== VARIABLES GLOBALES DEL TIMER =====
        let tiempoRestante = 25 * 60;
        let timerInterval = null;
        let timerActivo = false;
        let modoActual = 'normal';
        let rondaActual = 1;
        let rondasTotales = 1;
        let enDescanso = false;
        let tiempoPomodoro = 25 * 60;
        let tiempoDescanso = 5 * 60;
        let tiempoFlow = 25 * 60;
        let timerPausado = false;

        // ===== AUDIOS DE IVOOX =====
        const audios = {
            naturaleza: 'https://www.ivoox.com/player_es_podcast_149871_zp_1.html?c1=93ce58',
            lofi: 'https://www.ivoox.com/player_es_podcast_1154693_zp_1.html?c1=5293b6',
            clasica: 'https://www.ivoox.com/player_es_podcast_12925_zp_1.html?c1=69b9aa',
            relajante: 'https://www.ivoox.com/player_es_podcast_2340043_zp_1.html',
            podcast: 'https://www.ivoox.com/player_es_podcast_1561033_zp_1.html?c1=092151'
        };

        // ===== CONTADOR DE TAREAS =====
        let contadorTareas = 0;

        // ===== FUNCIONES DEL TIMER =====
        function actualizarDisplay() {
            const minutos = Math.floor(tiempoRestante / 60);
            const segundos = tiempoRestante % 60;
            const display = `${minutos.toString().padStart(2, '0')}:${segundos.toString().padStart(2, '0')}`;
            document.getElementById('timerDisplay').textContent = display;
        }

        function iniciarTimer() {
            if (timerActivo) return;

            timerActivo = true;
            const startBtn = document.getElementById('startBtn');
            startBtn.disabled = true;
            document.getElementById('pauseBtn').disabled = false;
            document.getElementById('timerMessage').classList.add('oculto');

            if (window.Worker) {
                const worker = new Worker(URL.createObjectURL(new Blob([`
                    let interval;
                    self.onmessage = function(e) {
                        if (e.data === 'start') {
                            interval = setInterval(() => {
                                self.postMessage('tick');
                            }, 1000);
                        } else if (e.data === 'stop') {
                            clearInterval(interval);
                        }
                    };
                `], { type: 'application/javascript' })));

                worker.onmessage = function (e) {
                    if (e.data === 'tick' && timerActivo) {
                        tiempoRestante--;
                        actualizarDisplay();

                        if (tiempoRestante <= 0) {
                            worker.postMessage('stop');
                            clearInterval(timerInterval);
                            timerActivo = false;
                            procesarFinTimer();
                        }
                    }
                };

                worker.postMessage('start');
                timerInterval = worker;
            } else {
                timerInterval = setInterval(() => {
                    tiempoRestante--;
                    actualizarDisplay();

                    if (tiempoRestante <= 0) {
                        clearInterval(timerInterval);
                        timerActivo = false;
                        procesarFinTimer();
                    }
                }, 1000);
            }
        }

        function pausarTimer() {
            if (!timerActivo) return;

            if (timerInterval && timerInterval.postMessage) {
                timerInterval.postMessage('stop');
            } else {
                clearInterval(timerInterval);
            }

            timerActivo = false;
            timerPausado = true;

            const startBtn = document.getElementById('startBtn');
            startBtn.disabled = false;
            startBtn.innerHTML = '<i class="fas fa-play"></i> Continuar';

            document.getElementById('pauseBtn').disabled = true;
        }

        function resetearTimer() {
            if (timerInterval && timerInterval.postMessage) {
                timerInterval.postMessage('stop');
            } else {
                clearInterval(timerInterval);
            }

            timerActivo = false;
            timerPausado = false;

            document.getElementById('timerDisplay').style.color = '';

            const mensajeDescanso = document.getElementById('mensajeDescanso');
            if (mensajeDescanso) {
                mensajeDescanso.remove();
            }

            if (modoActual === 'flow') {
                tiempoRestante = tiempoFlow;
            } else {
                tiempoRestante = tiempoPomodoro;
                enDescanso = false;
                rondaActual = 1;
            }

            actualizarDisplay();

            const startBtn = document.getElementById('startBtn');
            startBtn.disabled = false;
            startBtn.innerHTML = '<i class="fas fa-play"></i> Iniciar';

            document.getElementById('pauseBtn').disabled = true;
            document.getElementById('timerMessage').classList.add('oculto');
            actualizarInfoRonda();
        }

        function procesarFinTimer() {
            reproducirSonido('notificationSound');

            if (navigator.vibrate) {
                navigator.vibrate([200, 100, 200]);
            }

            detenerMusica();

            if (modoActual === 'normal') {
                mostrarMensajeCompletado();
            } else if (modoActual === 'focus') {
                if (!enDescanso) {
                    rondaActual++;

                    if (rondaActual > rondasTotales) {
                        mostrarMensajeSesionCompleta();
                        return;
                    }

                    enDescanso = true;
                    tiempoRestante = tiempoDescanso;
                    actualizarDisplay();

                    document.getElementById('timerDisplay').style.color = '#e74c3c';

                    reproducirSonido('descansoSound', 0.7);

                    actualizarInfoRondaConDescanso();

                    setTimeout(() => {
                        iniciarTimer();
                    }, 2000);
                } else {
                    enDescanso = false;

                    document.getElementById('timerDisplay').style.color = '';

                    const mensajeDescanso = document.getElementById('mensajeDescanso');
                    if (mensajeDescanso) {
                        mensajeDescanso.remove();
                    }

                    // Reproducir sonido al terminar el descanso
                    reproducirSonido('notificationSound');

                    tiempoRestante = tiempoPomodoro;
                    actualizarDisplay();

                    actualizarUIRondas();

                    setTimeout(() => {
                        iniciarTimer();
                    }, 2000);
                }
            } else if (modoActual === 'flow') {
                mostrarMensajeFlow();
            }

            const startBtn = document.getElementById('startBtn');
            startBtn.disabled = false;
            startBtn.innerHTML = '<i class="fas fa-play"></i> Iniciar';

            document.getElementById('pauseBtn').disabled = true;
        }

        function reiniciarPomodoro() {
            resetearTimer();
            document.getElementById('timerMessage').classList.add('oculto');
        }

        function mostrarMensajeCompletado() {
            document.getElementById('timerMessageText').textContent = '¬°Tiempo completado! Toma un descanso.';
            document.getElementById('btnMessageText').textContent = 'Nuevo Pomodoro';
            document.getElementById('timerMessage').classList.remove('oculto');
        }

        function mostrarMensajeSesionCompleta() {
            document.getElementById('timerMessageText').textContent = '¬°Sesi√≥n completada! üéâ';
            document.getElementById('btnMessageText').textContent = 'Nueva Sesi√≥n';
            document.getElementById('timerMessage').classList.remove('oculto');
        }

        function mostrarMensajeFlow() {
            document.getElementById('timerMessageText').textContent = '¬°Tiempo de Flow completado!';
            document.getElementById('btnMessageText').textContent = 'Agregar m√°s tiempo';
            document.getElementById('timerMessage').classList.remove('oculto');
        }

        function detenerMusica() {
            const iframe = document.getElementById('spotifyIframe');
            if (iframe && iframe.src) {
                iframe.src = iframe.src;
                console.log('M√∫sica reseteada');
            }
        }

        // ===== FUNCIONES DE MODO =====
        function cambiarModo(modo, event) {
            modoActual = modo;

            reproducirSonido('modoPomodoroSound');

            document.querySelectorAll('.modo-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            if (event && event.target) {
                event.target.closest('.modo-btn').classList.add('active');
            }

            actualizarConfigModo();
            resetearTimer();
        }

        function actualizarConfigModo() {
            const configDiv = document.getElementById('configModo');

            if (modoActual === 'normal') {
                configDiv.innerHTML = '';
                document.getElementById('rondaInfo').classList.add('oculto');
            } else if (modoActual === 'focus') {
                configDiv.innerHTML = `
                    <div class="config-focus">
                        <label for="rondasInput">N√∫mero de rondas:</label>
                        <input type="number" id="rondasInput" min="1" max="10" value="1">
                        <div class="tiempo-total" id="tiempoTotalFocus">Tiempo total: 0h 30m</div>
                    </div>
                `;
                document.getElementById('rondaInfo').classList.remove('oculto');

                const inputRondas = document.getElementById('rondasInput');
                inputRondas.addEventListener('input', function () {
                    actualizarValoresRondas();
                });

                setTimeout(() => {
                    actualizarValoresRondas();
                }, 50);

            } else if (modoActual === 'flow') {
                configDiv.innerHTML = `
                    <div class="config-flow">
                        <label for="tiempoFlowInput">Minutos iniciales:</label>
                        <input type="number" id="tiempoFlowInput" min="1" max="120" value="25" onchange="actualizarTiempoFlow()">
                    </div>
                `;
                document.getElementById('rondaInfo').classList.add('oculto');
                actualizarTiempoFlow();
            }
        }

        function actualizarUIRondas() {
            const tiempoTotal = (tiempoPomodoro + tiempoDescanso) * rondasTotales;
            const horas = Math.floor(tiempoTotal / 3600);
            const minutos = Math.floor((tiempoTotal % 3600) / 60);

            const tiempoTotalFocus = document.getElementById('tiempoTotalFocus');
            if (tiempoTotalFocus) {
                tiempoTotalFocus.textContent = `Tiempo total: ${horas}h ${minutos}m`;
            }

            const rondaActualElement = document.getElementById('rondaActual');
            const rondaTotalElement = document.getElementById('rondaTotal');
            const tiempoTotalElement = document.getElementById('tiempoTotal');

            if (rondaActualElement) {
                rondaActualElement.textContent = rondaActual;
            }
            if (rondaTotalElement) {
                rondaTotalElement.textContent = rondasTotales;
            }
            if (tiempoTotalElement) {
                tiempoTotalElement.textContent = `${horas}h ${minutos}m`;
            }

            console.log('üìä UI actualizada - Ronda:', rondaActual, 'de', rondasTotales);
        }

        function actualizarValoresRondas() {
            const inputRondas = document.getElementById('rondasInput');
            if (!inputRondas) return;

            const nuevoValor = parseInt(inputRondas.value) || 1;
            rondasTotales = nuevoValor;

            if (!timerActivo && !timerPausado && !enDescanso) {
                rondaActual = 1;
            }

            actualizarUIRondas();

            const mensajeDescanso = document.getElementById('mensajeDescanso');
            if (mensajeDescanso && !enDescanso) {
                mensajeDescanso.remove();
            }

            console.log('üìä Rondas actualizadas:', rondaActual, 'de', rondasTotales);
        }

        function actualizarInfoRondaConDescanso() {
            const tiempoTotal = (tiempoPomodoro + tiempoDescanso) * rondasTotales;
            const horas = Math.floor(tiempoTotal / 3600);
            const minutos = Math.floor((tiempoTotal % 3600) / 60);

            const rondaActualElement = document.getElementById('rondaActual');
            const rondaTotalElement = document.getElementById('rondaTotal');
            const tiempoTotalElement = document.getElementById('tiempoTotal');
            const rondaInfo = document.getElementById('rondaInfo');

            if (rondaActualElement) rondaActualElement.textContent = rondaActual;
            if (rondaTotalElement) rondaTotalElement.textContent = rondasTotales;
            if (tiempoTotalElement) tiempoTotalElement.textContent = `${horas}h ${minutos}m`;

            if (rondaInfo && enDescanso) {
                if (!document.getElementById('mensajeDescanso')) {
                    const mensajeDescanso = document.createElement('p');
                    mensajeDescanso.id = 'mensajeDescanso';
                    mensajeDescanso.style.cssText = 'color: #e74c3c; font-weight: bold; font-size: 16px; margin: 10px 0; animation: pulse 1.5s ease-in-out infinite;';
                    mensajeDescanso.innerHTML = '<i class="fas fa-mug-hot"></i> ‚è∏Ô∏è Tiempo de descanso (5 min)';
                    rondaInfo.insertBefore(mensajeDescanso, rondaInfo.firstChild);
                }
            }
        }

        function actualizarTiempoFlow() {
            const input = document.getElementById('tiempoFlowInput');
            tiempoFlow = (parseInt(input.value) || 25) * 60;
            tiempoRestante = tiempoFlow;
            actualizarDisplay();
        }

        function actualizarInfoRonda() {
            if (modoActual === 'focus') {
                actualizarValoresRondas();
            }
        }

        // ===== FUNCIONES DE TAREAS =====
        function crearTarea(texto = '') {
            contadorTareas++;
            const tareaId = `tarea-${contadorTareas}`;

            const tareaDiv = document.createElement('div');
            tareaDiv.className = 'tarea-nota';
            tareaDiv.id = tareaId;
            tareaDiv.innerHTML = `
                <div class="tarea-header">
                    <span class="tarea-numero">#${contadorTareas}</span>
                    <button class="tarea-eliminar" onclick="eliminarTarea('${tareaId}')">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <textarea class="tarea-textarea" placeholder="Escribe tu tarea aqu√≠...">${texto}</textarea>
                <div class="tarea-footer">
                    <select class="tarea-estado" onchange="cambiarEstado('${tareaId}', this.value)">
                        <option value="pendiente">üìù Pendiente</option>
                        <option value="proceso">‚ö° En Proceso</option>
                        <option value="terminado">‚úÖ Terminado</option>
                    </select>
                </div>
            `;

            return tareaDiv;
        }

        function agregarTarea() {
            const tareasLista = document.getElementById('tareasLista');
            const nuevaTarea = crearTarea();
            tareasLista.appendChild(nuevaTarea);
            verificarTareasCompletadas();
        }

        function eliminarTarea(tareaId) {
            const tarea = document.getElementById(tareaId);
            if (tarea) {
                tarea.remove();
                verificarTareasCompletadas();
            }
        }

        function cambiarEstado(tareaId, estado) {
            const tarea = document.getElementById(tareaId);
            if (!tarea) return;

            tarea.classList.remove('estado-pendiente', 'estado-proceso', 'estado-terminado');
            tarea.classList.add(`estado-${estado}`);

            verificarTareasCompletadas();
        }

        function verificarTareasCompletadas() {
            const todasLasTareas = document.querySelectorAll('.tarea-nota');
            const tareasTerminadas = document.querySelectorAll('.estado-terminado');
            const mensajeCompletado = document.getElementById('mensajeCompletado');

            if (todasLasTareas.length > 0 && todasLasTareas.length === tareasTerminadas.length) {
                mensajeCompletado.classList.remove('oculto');
            } else {
                mensajeCompletado.classList.add('oculto');
            }
        }

        // ===== FUNCI√ìN PARA CAMBIAR AUDIO =====
        function cambiarPlaylist(tipo) {
            const iframe = document.getElementById('spotifyIframe');
            iframe.src = audios[tipo];

            document.querySelectorAll('.playlist-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            const buttons = document.querySelectorAll('.playlist-btn');
            buttons.forEach(btn => {
                const onclickAttr = btn.getAttribute('onclick');
                if (onclickAttr && onclickAttr.includes(`'${tipo}'`)) {
                    btn.classList.add('active');
                }
            });
        }

        // ===== FUNCI√ìN PARA TOGGLE DE SPOTIFY =====
        function toggleSpotify() {
            const content = document.getElementById('spotifyContent');
            const btn = document.querySelector('.spotify-toggle-btn');
            const text = document.getElementById('spotifyToggleText');

            content.classList.toggle('active');
            btn.classList.toggle('active');

            if (content.classList.contains('active')) {
                text.textContent = 'Ocultar Reproductor';
            } else {
                text.textContent = 'Escucha Audio para Concentrarte';
            }
        }



        // ===== INICIALIZACI√ìN =====
        document.addEventListener('DOMContentLoaded', function () {
            const tareasLista = document.getElementById('tareasLista');
            tareasLista.appendChild(crearTarea());
            tareasLista.appendChild(crearTarea());

            actualizarDisplay();
            actualizarConfigModo();
            loadTheme();

            // Desbloquear audio con cualquier interacci√≥n del usuario
            document.body.addEventListener('click', desbloquearAudio, { once: true });
            document.body.addEventListener('touchstart', desbloquearAudio, { once: true });
        });




    </script>
</body>

</html>